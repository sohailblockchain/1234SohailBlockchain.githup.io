<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MuslimLogs Wallet — Demo</title>
   <title>MuslimLogs Wallet — Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <div class="flex items-center justify-between gap-4">
      <h1 class="text-2xl md:text-3xl font-bold">MuslimLogs Wallet — HTML Demo</h1>
      <div class="text-sm px-3 py-1 rounded-full bg-slate-800 border border-slate-700">
        Local API: <span id="apiBase" class="font-mono">http://127.0.0.1:5055</span>
      </div>
    </div>

    <p class="text-slate-300 mt-2">
      This UI talks to a local Wallet service (Python). Later, we package that service into a Windows .exe installer.
    </p>

    <!-- Status -->
    <div class="mt-4 p-4 rounded-xl bg-slate-900 border border-slate-800">
      <div class="flex items-center justify-between">
        <div>
          <div class="font-semibold">Service Status</div>
          <div id="statusText" class="text-slate-400 text-sm">Checking...</div>
        </div>
        <button id="btnPing" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">
          Ping
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-4">
      <!-- Wallet -->
      <div class="p-4 rounded-xl bg-slate-900 border border-slate-800">
        <h2 class="text-lg font-semibold">Wallet</h2>

        <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <button id="btnGenerate" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500">
            Generate New Wallet
          </button>

          <div class="flex gap-2">
            <input id="keyPath" class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-700 font-mono text-sm"
                   placeholder="key file path (e.g., keys/wallet.pem)" />
            <button id="btnLoad" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700">
              Load
            </button>
          </div>
        </div>

        <div class="mt-3">
          <div class="text-sm text-slate-400">Public Key (demo)</div>
          <pre id="pubKeyOut" class="mt-2 p-3 rounded-lg bg-slate-950 border border-slate-800 overflow-auto text-xs"></pre>
        </div>
      </div>

      <!-- Sign -->
      <div class="p-4 rounded-xl bg-slate-900 border border-slate-800">
        <h2 class="text-lg font-semibold">Sign Data</h2>

        <label class="block mt-3 text-sm text-slate-400">Message / Payload</label>
        <textarea id="payload" rows="6"
          class="w-full mt-2 p-3 rounded-lg bg-slate-950 border border-slate-700 font-mono text-sm"
          placeholder='{"type":"DEMO","data":"hello"}'></textarea>

        <div class="flex gap-3 mt-3">
          <button id="btnSign" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">
            Sign
          </button>
          <button id="btnClear" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700">
            Clear
          </button>
        </div>

        <div class="mt-3">
          <div class="text-sm text-slate-400">Signature</div>
          <pre id="sigOut" class="mt-2 p-3 rounded-lg bg-slate-950 border border-slate-800 overflow-auto text-xs"></pre>
        </div>
      </div>
    </div>

    <!-- Logs -->
    <div class="mt-4 p-4 rounded-xl bg-slate-900 border border-slate-800">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">Console</h2>
        <button id="btnCopy" class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700">
          Copy JSON
        </button>
      </div>
      <pre id="console" class="mt-3 p-3 rounded-lg bg-slate-950 border border-slate-800 overflow-auto text-xs"></pre>
    </div>

    <p class="text-slate-500 text-xs mt-6">
      Note: This is a demo UI. In production we can embed it inside the .exe (or open it in browser automatically).
    </p>
  </div>

<script>
  const API = document.getElementById("apiBase").innerText.trim();
  const elStatus = document.getElementById("statusText");
  const elConsole = document.getElementById("console");
  const elPub = document.getElementById("pubKeyOut");
  const elSig = document.getElementById("sigOut");

  function log(obj) {
    const text = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
    elConsole.textContent = text;
  }

  async function ping() {
    try {
      const r = await fetch(`${API}/health`);
      const j = await r.json();
      elStatus.textContent = `✅ Online — ${j.status || "ok"}`;
      log(j);
    } catch (e) {
      elStatus.textContent = "❌ Offline — start local wallet service on 127.0.0.1:5055";
      log({ error: String(e) });
    }
  }

  async function generateWallet() {
    const r = await fetch(`${API}/wallet/generate`, { method: "POST" });
    const j = await r.json();
    elPub.textContent = j.publicKey || "";
    log(j);
  }

  async function loadWallet() {
    const path = document.getElementById("keyPath").value.trim();
    const r = await fetch(`${API}/wallet/load`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ path })
    });
    const j = await r.json();
    elPub.textContent = j.publicKey || "";
    log(j);
  }

  async function signPayload() {
    let payload = document.getElementById("payload").value.trim();
    if (!payload) payload = '{"type":"DEMO","data":"hello"}';

    // try JSON, else send as string
    let data;
    try { data = JSON.parse(payload); } catch { data = payload; }

    const r = await fetch(`${API}/sign`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ data })
    });
    const j = await r.json();
    elSig.textContent = j.signature || "";
    log(j);
  }

  document.getElementById("btnPing").onclick = ping;
  document.getElementById("btnGenerate").onclick = generateWallet;
  document.getElementById("btnLoad").onclick = loadWallet;
  document.getElementById("btnSign").onclick = signPayload;
  document.getElementById("btnClear").onclick = () => {
    document.getElementById("payload").value = "";
    elSig.textContent = "";
    log("");
  };
  document.getElementById("btnCopy").onclick = async () => {
    await navigator.clipboard.writeText(elConsole.textContent || "");
  };

  ping();
</script>
</body>
</html>
